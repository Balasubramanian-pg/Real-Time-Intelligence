# **Step 4: Route Data to Destinations (For Complete Beginners)**

This is where we send our sorted factory data to different places - like a mailman delivering letters to different buildings. I'll explain every single button you need to click!

---

## **A. Sending to the Fast Lookup Room (Eventhouse)**

### **1. What is an Eventhouse?**
- Think of it like a super-fast notepad that can:
  - Write down new messages instantly
  - Answer questions like "Which machines are overheating RIGHT NOW?"

### **2. Step-by-Step Setup**

#### **a) Create the Eventhouse**
1. In your EventStream (where you see the conveyor belt diagram):
   - Click the **"+" button** next to your "HotMachines" branch
   - Select **"Eventhouse"** from the menu

2. A popup appears - click **"New Eventhouse"**
   - Name it: `EmergencyAlerts` (like an emergency notepad)
   - Click **"Create"**

*Wait 10 seconds while Microsoft builds your digital notepad*

#### **b) Teach It What to Write Down**
1. In the box that says **"KQL Query"**, type exactly:
   ```kql
   hot_machines
   | project machine, temperature, location
   | where temperature > 100
   ```
   (This means: "Only write down machines over 100°")

2. Click **"Apply"**

*Visual Guide:*
```
[ Hot Machines Branch ] --> [ EmergencyAlerts Eventhouse ]
      (150° temp data)      (Only writes if >100°)
```

### **3. Test It Works**
1. Go back to your sample data file
2. Change one temperature to `151` and save
3. In Fabric:
   - Click **"Refresh"** button (circular arrow)
   - Click your Eventhouse name
   - You should see the 151° reading appear!

---

## **B. Sending to the Big Filing Cabinet (Lakehouse)**

### **1. What is a Lakehouse?**
- Imagine a giant filing cabinet that:
  - Keeps EVERY temperature reading forever
  - Lets you make reports like "How often did Machine B overheat last month?"

### **2. Step-by-Step Setup**

#### **a) Create the Lakehouse**
1. Back in your EventStream:
   - Click the **"+" button** next to your "NormalMachines" branch
   - Select **"Lakehouse"**

2. In the popup:
   - Click **"New Lakehouse"**
   - Name it: `FactoryRecords` 
   - Click **"Create"**

*Wait 15 seconds - this cabinet takes longer to build*

#### **b) Set Up the File Folders**
1. Under **"Table name"**, type: `all_machine_data`
2. Make sure these boxes are checked:
   - ☑️ Create table if not exists
   - ☑️ Include all fields

3. Click **"Apply"**

*Visual Guide:*
```
[ NormalMachines Branch ] --> [ FactoryRecords Lakehouse ]
     (All temperature data)    (Keeps everything forever)
```

### **3. Test It Works**
1. Wait 2 minutes (the cabinet is slow at first)
2. In Fabric:
   - Click the **Lakehouse icon** (looks like a warehouse)
   - Click your `FactoryRecords`
   - Click the `all_machine_data` table
   - You should see ALL your test temperatures!

---

## **C. Setting Up the Alarm Bell (Fabric Activator)**

### **1. What is an Activator?**
- Like a factory alarm bell that:
  - Rings when a machine overheats
  - Can send messages to your phone/email/Teams

### **2. Step-by-Step Setup**

#### **a) Create the Alarm Rule**
1. In your EventStream:
   - Click the **"+" button** next to your "HotMachines" branch
   - Select **"Fabric Activator"**

2. Name your alarm: `OverheatSiren`

#### **b) Set the Temperature Trigger**
1. Under **"Condition"**:
   - Field: Select `temperature`
   - Operator: Select `>`
   - Value: Type `100`

#### **c) Make It Message You**
1. Click **"Add Action"**
2. Choose **"Teams"**
3. Connect your Microsoft account if asked
4. Type this message:
   ```
   🚨 EMERGENCY! {machine} is OVERHEATING at {location}!
   Current temperature: {temperature}°
   ```
   (The curly brackets auto-fill with real data)

5. Click **"Save"**

*Visual Guide:*
```
[ HotMachines Branch ] --> [ OverheatSiren Activator ] --> [ Your Teams Chat ]
      (150° temp data)       (If >100°)                  (Alert message)
```

### **3. Test the Alarm**
1. In your sample data, change a temperature to `151`
2. Save the file
3. Within 60 seconds:
   - Your Teams should get a new message!
   - If not, check your Activator and click "Run Test"

---

## **Troubleshooting Table**

| Problem | What to Do |
|---------|------------|
| Eventhouse not showing data | Click "Refresh", wait 30 sec |
| Lakehouse empty after 5 mins | Check if "Include all fields" was checked |
| Teams alert not coming | Check Teams notifications are enabled |
| Everything looks stuck | Save everything, close browser, reopen |

---

## **Important Notes**

1. **Data Delay Times:**
   - Eventhouse: Updates every 10 seconds
   - Lakehouse: Updates every 2-5 minutes
   - Activator: Alerts within 1 minute

2. **Cost Warning:**
   - Event Hubs costs $0.05/hour even when idle
   - Remember to delete resources when done practicing

3. **Next Steps:**
   - Try changing the temperature threshold to 120°
   - Add a second alert for humidity
   - Make the Teams message more detailed

Your data routing is now complete! You've built:
- A fast emergency notepad (Eventhouse)
- A permanent record keeper (Lakehouse)
- A shouting alarm system (Activator)

The factory is now smarter than most real factories! 🏭💡
